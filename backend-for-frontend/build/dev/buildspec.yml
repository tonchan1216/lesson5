version: 0.2
env:
  variables:
    SONAR_HOST_URL: "https://sonarcloud.io"
    SONAR_ORGANIZATION: "tonchan1216"
    SONAR_PROJECT_KEY: "lesson5_bff"
  parameter-store:
    SONAR_LOGIN: "ma-furutanito-sonar-password"
phases:
  install:
    runtime-versions:
      java: corretto11
    commands:
      - apt-get update -y
      - apt-get -y install language-pack-ja-base language-pack-ja
  pre_build:
    commands:
      - /usr/sbin/update-locale LANG=ja_JP.UTF-8 LANGUAGE="ja_JP:ja"
      - export LC_ALL="ja_JP.UTF-8"
      - locale-gen ja_JP.UTF-8
      - dpkg-reconfigure locales
  build:
    commands:
      - mvn -f common/pom.xml install
      - mvn -f backend-for-frontend/pom.xml package sonar:sonar -Dspring.profiles.active="test" -Dsonar.host.url=${SONAR_HOST_URL} -Dsonar.login=${SONAR_LOGIN} -Dsonar.projectKey=${SONAR_PROJECT_KEY} -Dsonar.organization=${SONAR_ORGANIZATION}

artifacts:
  files:
    - backend-for-frontend/target/lesson5-bff-0.0.1-SNAPSHOT.jar